#!/usr/bin/env bash

skip_reset="$1"

export PATH="$PATH:~/bin"

set-xterm-title "OSS webpack dev server"

. "$HOME/.rvm/scripts/rvm"

# Because 'nvm' is a shell function:
. "$HOME/.nvm/nvm.sh"

cd ~/projects/oss/huddle || exit 1

if [ "$skip_reset" != "skip" ]
then
    rm -rf node_modules vendor/node_modules || exit 1
fi

NVM_VERSION=8 # stable (10) was failing to build node-sass.
export NODE_OPTIONS='--max-old-space-size=5120'

bundle install \
    && nvm install "$NVM_VERSION" \
    && (yarn check || yarn install) \
    && bin/webpack-dev-server --inline
