#!/usr/bin/env bash

set-xterm-title "MS Teams"

function kill_webserver() {
    port=9229
    curl --silent "http://localhost:$port"
    if [ $? -ne 7 ]
    then
       echo "The webserver is already running on port $port. Killing it."
       kill $(lsof | grep -w localhost:9229 | awk '{print $2}' | uniq)
    fi

    return 0
}

cd ~/projects/oss/oss_ms_teams \
    && . "$HOME/.ssh/ms-teams.sh" \
    && . "$HOME/.nvm/nvm.sh" \
    && kill_webserver \
    && nvm install 10 \
    && (yarn check || yarn install) \
    && yarn run debug --max_old_space_size=4096
